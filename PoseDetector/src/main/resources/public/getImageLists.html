<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Get Image List</title>

    <script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyCmhAJD-slGnxQohv96J0MFRkN9vqi4gJg",
            authDomain: "demouploadvideo-bdc04.firebaseapp.com",
            databaseURL: "https://demouploadvideo-bdc04.firebaseio.com",
            projectId: "demouploadvideo-bdc04",
            storageBucket: "gs://demouploadvideo-bdc04.appspot.com",
            messagingSenderId: "404242634566"
        };
        firebase.initializeApp(config);
    </script>

    <script language="JavaScript" type="text/javascript">
        var listImgKey = new Array();
        var listSimgKey = new Array();
        var simgSample;
        var imgSample;
        listImg = getParams("listImg");
        listSimg = getParams("listSimg");
        var suggestionId = getParams("suggestionId");
        function getParams(key) {
            var params = {};
            location.search.replace(/[?&;]+([^=]+)=([^&;]*)/gi, function (s, key, value) {
                params[key] = value
            })
            return key ? params[key] : params;
        }

        function getImageList() {
            var flag1 = false;
            var flag2 = false;
            listSimgQuery = firebase.database().ref(listSimg).orderByKey();
            listSimgQuery.once("value")
                .then(function (snapshot) {
                    snapshot.forEach(function (childSnapshot) {
                        listSimgKey.push(childSnapshot.key);
                        // simgSample = childSnapshot.val();
                    });
                    flag1 = true;
                });

            listImgQuery = firebase.database().ref(listImg).orderByKey();
            listImgQuery.once("value")
                .then(function (snapshot) {
                    snapshot.forEach(function (childSnapshot) {
                        listImgKey.push(childSnapshot.key);
                        // imgSample = childSnapshot.val();
                    });
                    flag2 = true;
                });
            var readyStateCheckInterval = setInterval(function () {
                if (flag1 && flag2) {
                    clearInterval(readyStateCheckInterval);
                    sendImageLists();
                }
            }, 10);
        }
        function sendImageLists() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    window.close();
                }
            };
            xhttp.open("POST", "http://localhost:8090/matchVideo", true);
            xhttp.setRequestHeader("Content-type", "application/json");
            //listSimg is Trainer folder name; listImg is Trainee folder
            var imageListArr  = [listSimgKey, listImgKey, suggestionId, listSimg, listImg];
            xhttp.send(JSON.stringify(imageListArr));
        }
    </script>

</head>

<body onload="getImageList()">
</body>

</html>


